<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agartha Penguin Realm</title>
    <style>
        body { 
            margin: 0; 
            font-family: Arial, sans-serif; 
            background: #000;
        }
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            margin: 20px auto;
            background: linear-gradient(to bottom, #d0d0d0, #a0a0a0) !important; /* fallback gray gradient */
            background-image: url('https://static-prod.cdnilpost.com/wp-content/uploads/2025/12/24/1766536521-agartha-1.jpg') !important;
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            border: 4px solid #a0c0ff; /* icy blue border */
            overflow: hidden;
            box-shadow: 0 0 25px rgba(0,0,0,0.8);
        }
        .penguin {
            position: absolute;
            width: 50px;
            height: 50px;
            background-image: url('https://e7.pngegg.com/pngimages/18/190/png-clipart-club-penguin-island-wikia-club-penguin-elite-penguin-force-purple-club-penguin.png');
            background-size: contain;
            background-repeat: no-repeat;
            transition: left 0.1s ease-out, top 0.1s ease-out;
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.6));
        }
        .name-tag {
            position: absolute;
            top: -22px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #fff;
            text-shadow: 1px 1px 3px #000;
            font-weight: bold;
            white-space: nowrap;
            background: rgba(0,0,0,0.6);
            padding: 3px 8px;
            border-radius: 5px;
        }
        #chat-container {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 340px;
            height: 180px;
            background: rgba(255, 255, 255, 0.8) !important;
            border: 2px solid #444;
            border-radius: 10px;
            padding: 10px;
            overflow-y: scroll;
            color: #111;
            font-size: 13px;
        }
        #chat-input {
            position: absolute;
            bottom: 205px;
            left: 10px;
            width: 340px;
            padding: 8px;
            border: 2px solid #444;
            border-radius: 6px;
            background: rgba(255,255,255,0.95);
            font-size: 14px;
        }
        #chat-container::-webkit-scrollbar {
            width: 8px;
        }
        #chat-container::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 4px;
        }
        iframe.video-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            border: none;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
    <div id="game-container">
        <div id="chat-container"></div>
        <input type="text" id="chat-input" placeholder="Chat with fellow penguins..." maxlength="100">
    </div>

    <script>
        // REPLACE WITH YOUR ACTUAL FIREBASE CONFIG !!!
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const playerId = Math.random().toString(36).substr(2, 9);
        const playerName = prompt('Enter your penguin name:') || `Penguin${Math.floor(Math.random()*1000)}`;
        
        const playersRef = db.ref('players');
        const chatRef = db.ref('chat');

        let player = {
            x: Math.random() * 700 + 50,
            y: Math.random() * 500 + 50,
            name: playerName,
            facing: 'right'
        };
        let keys = {};
        let lastTime = 0;
        let lastUpdate = 0;
        const speed = 250;
        const UPDATE_INTERVAL = 50;

        const container = document.getElementById('game-container');
        const penguinElem = document.createElement('div');
        penguinElem.className = 'penguin';
        penguinElem.id = playerId;
        const nameTag = document.createElement('div');
        nameTag.className = 'name-tag';
        nameTag.textContent = playerName;
        penguinElem.appendChild(nameTag);
        container.appendChild(penguinElem);

        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            if (e.key === 'Enter') sendChat();
        });
        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        function gameLoop(time) {
            const dt = Math.min((time - lastTime) / 1000, 0.05);
            lastTime = time;

            let vx = 0, vy = 0;
            if (keys['arrowleft'] || keys['a']) vx -= 1;
            if (keys['arrowright'] || keys['d']) vx += 1;
            if (keys['arrowup'] || keys['w']) vy -= 1;
            if (keys['arrowdown'] || keys['s']) vy += 1;

            if (vx !== 0 || vy !== 0) {
                const mag = Math.sqrt(vx * vx + vy * vy) || 1;
                vx = (vx / mag) * speed * dt;
                vy = (vy / mag) * speed * dt;

                player.x = Math.max(25, Math.min(775, player.x + vx));
                player.y = Math.max(25, Math.min(575, player.y + vy));

                if (vx > 0) player.facing = 'right';
                else if (vx < 0) player.facing = 'left';

                penguinElem.style.left = `${player.x}px`;
                penguinElem.style.top = `${player.y}px`;
                penguinElem.style.transform = `scaleX(${player.facing === 'left' ? -1 : 1})`;

                if (Date.now() - lastUpdate > UPDATE_INTERVAL) {
                    playersRef.child(playerId).set(player);
                    lastUpdate = Date.now();
                }
            }

            requestAnimationFrame(gameLoop);
        }

        playersRef.on('value', (snapshot) => {
            const players = snapshot.val() || {};
            Object.keys(players).forEach(id => {
                if (id === playerId) return;
                let otherElem = document.getElementById(id);
                if (!otherElem) {
                    otherElem = document.createElement('div');
                    otherElem.className = 'penguin';
                    otherElem.id = id;
                    const otherNameTag = document.createElement('div');
                    otherNameTag.className = 'name-tag';
                    otherElem.appendChild(otherNameTag);
                    container.appendChild(otherElem);
                }
                const p = players[id];
                otherElem.style.left = `${p.x}px`;
                otherElem.style.top = `${p.y}px`;
                otherElem.style.transform = `scaleX(${p.facing === 'left' ? -1 : 1})`;
                otherElem.querySelector('.name-tag').textContent = p.name;
            });
        });

        playersRef.on('child_removed', (snapshot) => {
            const elem = document.getElementById(snapshot.key);
            if (elem) elem.remove();
        });

        const chatContainer = document.getElementById('chat-container');
        const chatInput = document.getElementById('chat-input');
        const triggers = [
            "taiwan is not part of china",
            "ccp and the roc are both sovereign nations",
            "the ccp does not own taiwan",
            "taiwan not owned by ccp",
            "taiwan not owned by china",
            "taiwan independent"
        ];
        function sendChat() {
            const msg = chatInput.value.trim().toLowerCase();
            if (msg) {
                if (triggers.some(trigger => msg.includes(trigger))) {
                    // Trigger detected - change to video background and kick after 30s
                    const videoIframe = document.createElement('iframe');
                    videoIframe.className = 'video-bg';
                    videoIframe.src = 'https://www.youtube.com/embed/pfDChaT6pdw?autoplay=1&loop=1&playlist=pfDChaT6pdw&mute=0';
                    videoIframe.allow = 'autoplay; fullscreen';
                    container.appendChild(videoIframe);
                    setTimeout(() => {
                        document.body.innerHTML = '<div style="text-align:center; color:white; background:black; padding:50px;"><h1>You Have Been Kicked</h1><p>It seems you started blaming you keyboard randomly don\'t let this happen again! "Chairman Mao would not stand for this idocratcy."</p></div>';
                    }, 30000);
                } else {
                    // Normal chat
                    chatRef.push({ name: playerName, message: chatInput.value, time: Date.now() });
                }
                chatInput.value = '';
            }
        }
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChat();
        });

        chatRef.on('child_added', (snapshot) => {
            const data = snapshot.val();
            const msgElem = document.createElement('div');
            msgElem.innerHTML = `<strong>${data.name}:</strong> ${data.message}`;
            chatContainer.appendChild(msgElem);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            while (chatContainer.children.length > 50) {
                chatContainer.removeChild(chatContainer.firstChild);
            }
        });

        playersRef.child(playerId).onDisconnect().remove();

        playersRef.child(playerId).set(player);
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
